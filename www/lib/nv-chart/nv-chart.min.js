/*! nv-chart v0.1.1 | 2014-07-15 */
!function(){"use strict";function a(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}function b(a){return a instanceof Array}var c=angular.module("nvChart",[]);Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var d=function(c,d,e){var f=this,g={chartType:null,data:[],color:[],margin:{},width:null,height:null,showLegend:!0,noData:null,tooltips:!0,tooltipContent:null,useInteractiveGuideline:!1,transitionDuration:null,showXAxis:!0,xValue:null,xShowMaxMin:!0,xAxisLabel:null,xAxisTickFormat:null,x2AxisLabel:null,x2AxisTickFormat:null,showYAxis:!0,yValue:null,yShowMaxMin:!0,yAxisLabel:null,yAxisTickFormat:null,rightAlignYAxis:!1,y1AxisLabel:null,y1AxisTickFormat:null,y2AxisLabel:null,y2AxisTickFormat:null,y3AxisLabel:null,y3AxisTickFormat:null,y4AxisLabel:null,y4AxisTickFormat:null,showLabels:!0,labelThreshold:.5,labelType:"key",donut:!1,donutRatio:0,staggerLabels:!1,showValues:!1,showDistX:!1,showDistY:!1,onlyCircles:!1},h=["xAxis","x2Axis","yAxis","y1Axis","y2Axis","y3Axis","y4Axis"];f.data=[],f.model=f.modelFn=null,f.config=a(g,{}),f.updateConfig=function(b){f.config=a(f.config,b),"object"==typeof f.config.data&&(f.data=f.config.data)},f.updateModel=function(){f.model&&f.drawModel(f.model)},f.setChartType=function(a){"string"==typeof a&&(f.modelFn=nv.models[a])},f.configAxis=function(a){"function"==typeof f.config.xValue&&a.x(f.config.xValue),"function"==typeof f.config.yValue&&a.y(f.config.yValue),a.xAxis&&a.xAxis.showMaxMin&&a.xAxis.showMaxMin(!!f.config.xShowMaxMin),a.yAxis&&a.yAxis.showMaxMin&&a.yAxis.showMaxMin(!!f.config.yShowMaxMin),angular.forEach(h,function(b){f.setAxisLabel(a,b),f.setTickFormat(a,b)})},f.setAxisLabel=function(a,b){var c=f.config[b+"Label"];a[b]&&a[b].axisLabel&&"string"==typeof c&&a[b].axisLabel(c)},f.setTickFormat=function(a,b){var c=f.config[b+"TickFormat"];a[b]&&a[b].tickFormat&&"string"==typeof c?a[b].tickFormat(d3.format(c)):a[b]&&a[b].tickFormat&&"function"==typeof c&&a[b].tickFormat(c)},f.render=function(){if(f.model&&e.unbindModel(f.model),f.setChartType(f.config.chartType),f.modelFn){var a=f.modelFn();f.drawModel(a)}},f.redraw=function(){f.model&&f.model.update()},f.drawModel=function(a){a.margin&&null!==f.config.margin&&"object"==typeof f.config.margin&&a.margin(f.config.margin),a.color&&b(f.config.color)&&f.config.color.length&&a.color(f.config.color),a.width&&"number"==typeof f.config.width&&a.width(f.config.width),a.height&&"number"==typeof f.config.height&&a.height(f.config.height),a.rightAlignYAxis&&a.rightAlignYAxis(!!f.config.rightAlignYAxis),a.showLegend&&a.showLegend(!!f.config.showLegend),a.showXAxis&&a.showXAxis(!!f.config.showXAxis),a.showYAxis&&a.showYAxis(!!f.config.showYAxis),"string"==typeof f.config.noData&&a.noData(f.config.noData),a.useInteractiveGuideline&&a.useInteractiveGuideline(!!f.config.useInteractiveGuideline),a.staggerLabels&&a.staggerLabels(!!f.config.staggerLabels),a.tooltips&&a.tooltips(!!f.config.tooltips),"string"==typeof f.config.tooltipContent&&a.tooltipContent(f.config.tooltipContent),a.showValues&&a.showValues(!!f.config.showValues),a.showLabels&&a.showLabels(!!f.config.showLabels),a.forceX&&f.config.forceX instanceof Array&&a.forceX(f.config.forceX),a.forceY&&f.config.forceY instanceof Array&&a.forceY(f.config.forceY),a.labelThreshold&&"number"==typeof f.config.labelThreshold&&a.labelThreshold(f.config.labelThreshold),a.labelType&&a.labelType(f.config.labelType),a.donut&&a.donut(!!f.config.donut),a.donutRatio&&a.donutRatio(f.config.donutRatio),a.showDistX&&a.showDistX(!!f.config.showDistX),a.showDistY&&a.showDistY(!!f.config.showDistY),a.scatter&&a.scatter.onlyCircles&&a.scatter.onlyCircles(!!f.config.onlyCircles),f.configAxis(a),d.find("svg").remove();var c=d3.select(d[0]).append("svg").datum(f.data);"number"==typeof f.config.transitionDuration&&(c=c.transition().duration(f.config.transitionDuration)),c.call(a),e.bindModel(a),f.model=a}},e=function(a,b){var c=this,d=["lines","bars","pie","discretebar","multibar","scatter"];c.bindModel=function(a){a.legend&&a.legend.dispatch.on("legendClick.nv-chart",function(a,c){b.$broadcast("legendClick.nv-chart",a,c)}),angular.forEach(d,function(b){c.bindElementClick(a,b)})},c.bindElementClick=function(a,c){a[c]&&a[c].dispatch.elementClick&&a[c].dispatch.on("elementClick.nv-chart",function(a,c){b.$broadcast("elementClick.nv-chart",a,c)})},c.unbindModel=function(a){a.legend&&a.legend.dispatch.on("legendClick.nv-chart",null),angular.forEach(d,function(b){c.unbindElementClick(a,b)})},c.unbindElementClick=function(a,b){a[b]&&a[b].dispatch.elementClick&&a[b].dispatch.on("elementClick.nv-chart",null)}};c.controller("chartController",["$scope",function(){var a=this,b=a.menuItems=[];a.addMenuItem=function(a){b.push(a)},a.removeMenuItem=function(a){var c=b.indexOf(a);b.splice(c,1)}}]),c.directive("nvChart",["$window","$rootScope","$timeout",function(b,c,f){var g={scope:!0,controller:"chartController",template:'<ul style="display:none;" nv-chart-menu></ul>',link:function(g,h,i,j){var k=g.$parent,l=angular.element(h),m=new e(g,c),n=new d(g,l,m),o=[];g.getElementDimensions=function(){return{h:l[0].offsetHeight,w:l[0].offsetWidth}},angular.element(b).bind("resize",n.redraw),g.$watch(i.nvChart,function(){var a=k.$eval(i.nvChart);a?p(a):q()});var p=function(c){c.$reload=function(){n.updateConfig(c),n.updateModel()},o.push(g.$watch(g.getElementDimensions,n.redraw,!0));var d=function(a){n.config.chartType!==a&&(n.updateConfig(c),n.render(),f(function(){n.redraw()}))};if(o.push(k.$watch(i.nvChart+".chartType",d)),"string"==typeof c.data){var e=function(b){n.data=b?a([],b):[],n.render(),f(function(){n.redraw()})};o.push(k.$watch(c.data,e)),o.push(k.$watch(c.data+".length",function(){e(k.$eval(c.data))}))}g.$on("$destroy",function(){q(),delete c.$reload,angular.element(b).off("resize.nv-chart",n.redraw),m.unbindModel(n.model)}),angular.forEach(c.plugins,function(a){"function"==typeof a&&(a=new a),a.init(g.$new(),h,n,j)})},q=function(){angular.forEach(o,function(a){a()}),o=[],n.data=[],n.render(),f(function(){n.redraw()})}}};return g}]),c.directive("nvChartMenu",["$window",function(a){return{require:"^nvChart",scope:{},replace:!0,template:'<ul class="nv-chart-menu" ><li ng-repeat="item in menuItems" ng-click="item.onClick(item)"><a>{{item.name}}</a></li></ul>',link:function(b,c,d,e){function f(a){a.css("display","none"),k=!1}function g(a,b){b.css("display","block");var c=angular.element(b).offsetParent().offset();b.css("position","absolute"),b.css("top",Math.max(a.pageY-c.top,0)+"px"),b.css("left",Math.max(a.pageX-c.left,0)+"px"),k=!0}function h(a){!k||2===a.button&&a.target===i||f(j)}var i,j=angular.element(c),k=!1,l=angular.element(a);b.menuItems=e.menuItems,j.parent().bind("contextmenu",function(a){a.preventDefault(),i=a.target,b.menuItems&&b.menuItems.length>0&&g(a,j)}),l.bind("keyup",function(a){k&&27===a.keyCode&&f(j)}),l.bind("click",h),l.bind("contextmenu",h)}}}])}(window);